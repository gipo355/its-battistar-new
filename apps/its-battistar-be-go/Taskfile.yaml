# https://taskfile.dev
version: '3'
tasks:
  init:
    desc: Install some important commands and tools
    cmds:
      # tools
      - go install github.com/swaggo/swag/cmd/swag@latest
      - go install github.com/goreleaser/goreleaser@latest
      # - go install github.com/a-h/templ/cmd/templ@latest
      - go install github.com/vektra/mockery/v2@latest
      # linting, formatting
      - go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.58.1
      - go install github.com/segmentio/golines@latest
      - go install golang.org/x/tools/cmd/goimports@latest
      - go install github.com/securego/gosec/v2/cmd/gosec@latest
      - go install mvdan.cc/gofumpt@latest
      # prepare dependencies
      - go mod tidy
  assets:
    desc: Build the assets
    cmds:
      - echo "Building assets"
  generate:
    desc: Generate stuff and things
    cmds:
      - go generate ./...
      # - swag init -g ./cmd/api/main.go
  run:
    desc: Run the application
    deps:
      - assets
      - generate
    cmds:
      - go run ./cmd/app/...
  dev:
    desc: Develop the api
    deps:
      - assets
      - generate
    cmds:
      - air -c .air.api.toml
  build-api:
    desc: build the api
    deps:
      - assets
      - generate
    cmds:
      # - go build -o ./bin/api ./cmd/api/...
      - go build -o=../../dist/apps/its-battistar-be-go/ ./cmd/server
  serve-api:
    desc: Build and serve the api
    deps:
      - build-api
    cmds:
      # - ./bin/api
      - ../../dist/apps/its-battistar-be-go/server
  fix:
    desc: Fix the code
    cmds:
      - golines --shorten-comments -w .
      - goimports -w .
      - gofumpt -w .
      - go mod tidy
  lint:
    desc: Lint project
    cmds:
      - gofumpt -l .
      - golangci-lint run
      - gosec ./...
  test:
    desc: Run the tests
    cmds:
      - go test ./...
  release:
    desc: Release the application
    cmds:
      - goreleaser release --rm-dist
